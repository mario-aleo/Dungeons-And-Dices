<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input-container.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<!--link rel="import" href="../bower_components/paper-fab/paper-fab.html"-->

<dom-module id="create-status-card">
    <template>
        <style>
            :host {
                display: block;
                @apply(--layout-vertical);
            }

            paper-card {
                margin-bottom: 16px;
            }

            .dependency-add-button {
                margin: 8px 0 0 0;
                color: var(--secondary-color);
            }

            .dependency-remove-button {
                @apply(--layout-self-end);
                min-width: 40px;
                color: #F44336;
            }

            .card-actions-button {
                color: #F44336;
            }

            .dependency-container {
                position: relative;
                @apply(--layout-horizontal);
            }

            .dependency-content:nth-child(1) {
                margin-right: 8px;
            }
            .dependency-content:nth-child(2) {
                margin: 0 8px;
            }
            .dependency-content:nth-child(3) {
                margin: 0 8px;
            }
        </style>

        <paper-card>
            <div class="card-content">
                <paper-input-container>
                    <label>Name</label>
                    <input is="iron-input"
                           bind-value="{{ name }}">
                </paper-input-container>

                <paper-input-container>
                    <label>Inital Value</label>
                    <input is="iron-input"
                           bind-value="{{ baseValue }}">
                </paper-input-container>

                <paper-input-container>
                    <label>Value Modifier per Level</label>
                    <input is="iron-input"
                           bind-value="{{ levelModifier }}">
                </paper-input-container>

                
                <template is="dom-repeat"
                          items="{{ dependencyList }}">
                    <div class="dependency-container">

                        <paper-dropdown-menu label="Type"
                                             class="dependency-content">
                            <paper-listbox class="dropdown-content"
                                           attr-for-selected="modifier-type"
                                           selected="{{ item.location }}"
                                           id="{{ index }}"
                                           on-iron-select="_dependencyLocationChanged">
                                <paper-item modifier-type="None">None</paper-item>
                                <paper-item modifier-type="statusList">Status</paper-item>
                                <paper-item modifier-type="resourcesList">Resource</paper-item>
                                <paper-item modifier-type="defensesList">Defense</paper-item>
                                <paper-item modifier-type="skillsList">Skill</paper-item>
                            </paper-listbox>
                        </paper-dropdown-menu>

                        <paper-dropdown-menu label="Modifier"
                                             class="dependency-content">
                            <paper-listbox class="dropdown-content"
                                           id="name{{ index }}"
                                           attr-for-selected="modifier-name"
                                           selected="{{ item.name }}">
                                <template is="dom-if"
                                          if="{{ _locationIsStatusList(item.location) }}">
                                    <template is="dom-repeat"
                                              items="{{ statusList }}">
                                        <paper-item modifier-name="{{ item.name }}">{{ item.name }}</paper-item>
                                    </template>
                                </template>
                                <template is="dom-if"
                                          if="{{ _locationIsResourcesList(item.location) }}">
                                    <template is="dom-repeat"
                                              items="{{ resourcesList }}">
                                        <paper-item modifier-name="{{ item.name }}">{{ item.name }}</paper-item>
                                    </template>
                                </template>
                                <template is="dom-if"
                                          if="{{ _locationIsDefensesList(item.location) }}">
                                    <template is="dom-repeat"
                                              items="{{ defensesList }}">
                                        <paper-item modifier-name="{{ item.name }}">{{ item.name }}</paper-item>
                                    </template>
                                </template>
                                <template is="dom-if"
                                          if="{{ _locationIsSkillsList(item.location) }}">
                                    <template is="dom-repeat"
                                              items="{{ skillsList }}">
                                        <paper-item modifier-name="{{ item.name }}">{{ item.name }}</paper-item>
                                    </template>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>

                        <paper-input-container class="dependency-content">
                            <label>Value</label>
                            <input is="iron-input"
                                   bind-value="{{ item.value }}">
                        </paper-input-container>

                        <paper-icon-button class="dependency-remove-button"
                                           icon="remove"
                                           on-click="_deleteDependency"></paper-icon-button>

                    </div>
                </template>
                <paper-button class="dependency-add-button"
                              on-click="_addDependency">Add Dependency</paper-button>
            </div>
            <div class="card-actions">
                <paper-button class="card-actions-button"
                              on-click="_requestDeleteStatus">Delete</paper-button>
            </div>
        </paper-card>
    </template>
</dom-module>

<script>
    Polymer({

        is: "create-status-card",

        properties: {
            index: {
                type: Number
            },
            name: {
                type: String,
                notify: true
            },
            baseValue: {
                type: String,
                notify: true
            },
            levelModifier: {
                type: String,
                notify: true
            },
            dependencyList: {
                type: Array,
                notify: true
            },
			statusList: {
				type: Array,
                notify: true
			},
            resourcesList: {
                type: Array
            },
            defensesList: {
                type: Array
            },
            skillsList: {
                type: Array
            }
        },

        _addDependency: function(e){
            this.push("dependencyList", {
                location: "None",
                name: null,
                value: null
            });
        },

        _deleteDependency: function(e){
            this.splice("dependencyList", e.model.__data__.index, 1);
        },

        _requestDeleteStatus: function(e){
            this.fire("requestDeleteStatus", {
                index: this.index
            });
        },

        _dependencyLocationChanged: function(e, detail){
            if(this.$$('#name' + detail.item.parentElement.id) !== null){
                this.$$('#name' + detail.item.parentElement.id).selected = null;
            }
        },

        _locationIsStatusList: function(type){
            return type == 'statusList';
        },

        _locationIsResourcesList: function(type){
            return type == 'resourcesList';
        },

        _locationIsDefensesList: function(type){
            return type == 'defensesList';
        },

        _locationIsSkillsList: function(type){
            return type == 'skillsList';
        },
    });
</script>
