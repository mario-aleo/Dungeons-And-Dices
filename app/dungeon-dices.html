<!--link href="../assets/bower_components/polymer/polymer.html" rel="import"-->

<dom-module id="dungeon-dices">
    <template>
        <style>
            :root {
                --primary-text-color: #212121;
                --primary-background-color: #ffffff;
                --secondary-text-color: #727272;
                --disabled-text-color: #9b9b9b;
                --divider-color: #B6B6B6;
                --primary-color: #9E9E9E;
                --light-primary-color: #F5F5F5;
                --dark-primary-color: #616161;
                --accent-color: #03A9F4;
                --light-accent-color: #ff80ab;
                --dark-accent-color: #f50057;
                --paper-fab-keyboard-focus-background: #03A9F4;
                --paper-tabs-selection-bar-color: #03A9F4;
            }

            paper-menu {
                --paper-menu-selected-item: {
                    color: var(--accent-color);
                }

                --paper-menu-focused-item-after: {
                    color: var(--accent-color);
                    background: var(--primary-color);
                }
            }

            paper-menu iron-icon {
                margin-right: 33px;
                opacity: 0.54;
            }

            paper-menu a {
                @apply(--layout-horizontal);
                @apply(--layout-center);

                text-decoration: none;
                color: var(--accent-color);
                font-family: 'Roboto', 'Noto', sans-serif;
                -webkit-font-smoothing: antialiased;
                text-rendering: optimizeLegibility;
                font-size: 14px;
                font-weight: 400;
                line-height: 24px;
                min-height: 48px;
                padding: 0 16px;
            }

            paper-menu:focus {
                outline: none;
            }

            iron-pages {
                overflow-y: auto;
                height: calc(100vh - 70px);
            }

            .app-name {
                @apply(--paper-font-title);
                margin-right: 0.5em;
            }

            #drawerToolbar {
                background-color: var(--primary-color);
            }

            #mainToolbar {
                @apply(--layout-horizontal);
                @apply(--layout-center);
                background-color: var(--primary-color);
                color: white;
            }

            #mainToggle {
                margin-right: 16px;
            }

            #mainIcon {
                width: 36px;
            }

            @media (min-width: 641px) {
                #mainToggle {
                    display: none;
                }
            }
        </style>

        <platinum-sw-register auto-register
                              skip-waiting
                              clients-claim
                              reload-on-install
                              href="../sw-import.js">
            <platinum-sw-cache default-cache-strategy="networkFirst"></platinum-sw-cache>
        </platinum-sw-register>

        <app-location use-hash-as-path
                      route="{{ route }}"></app-location>

        <app-route route="{{ route }}"
                   pattern="/:page"
                   data="{{ dataRoute }}"></app-route>

        <iron-localstorage name="localstorageSheetList"
                           value="{{ sheetList }}"
                           on-iron-localstorage-load-empty="initializeDefaultSheetList"></iron-localstorage>

        <iron-localstorage name="localstorageBaseSheet"
                           value="{{ baseSheet }}"
                           on-iron-localstorage-load-empty="initializeDefaultBaseSheet"></iron-localstorage>

        <iron-localstorage name="localstorageCreatingSheet"
                           value="{{ creatingSheet }}"
                           on-iron-localstorage-load-empty="initializeDefaultCreatingSheet"></iron-localstorage>

        <paper-drawer-panel fullbleed>
            <paper-header-panel drawer>
                <!-- Drawer Toolbar -->
                <paper-toolbar id="drawerToolbar">
                </paper-toolbar>
                <!-- Drawer Content -->
                <paper-menu>
                    <iron-selector attr-for-selected="data-route"
                                   selected="{{ dataRoute.page }}">
                        <a data-route="home"
                           href="#/home"
                           on-click="sideNavRouteWillChange">
                            <iron-icon icon="home"></iron-icon>
                            <span>Home</span>
                        </a>
                    </iron-selector>
                </paper-menu>
            </paper-header-panel>

            <paper-header-panel main fixed>
                <!-- Main Toolbar -->
                <paper-toolbar id="mainToolbar">
                    <paper-icon-button id="mainToggle"
                                       icon="menu"
                                       paper-drawer-toggle></paper-icon-button>
                    <!-- Application name -->
                    <div class="app-name">Dungeons 'n Dices</div>
                    <img id="mainIcon" src="../assets/img/dices.svg" />
                </paper-toolbar>
                <!-- Main Content -->
                <iron-pages id="pagesMainContent"
                            attr-for-selected="data-route"
                            selected="{{ dataRoute.page }}">
                    <section data-route="home">
                        <sheet-list sheet-list="{{ sheetList }}"></sheet-list>
                    </section>
                    <section data-route="sheetDetail">
                        <sheet-detail></sheet-detail>
                    </section>
                    <section data-route="sheetCreation">
                        <sheet-creation sheet-list="{{ sheetList.list }}"
                                        base-sheet="{{ baseSheet }}"
                                        creating-sheet="{{ creatingSheet }}"></sheet-creation>
                    </section>
                </iron-pages>
            </paper-header-panel>
        </paper-drawer-panel>

    </template>
</dom-module>

<script>
    Polymer({
        is: "dungeon-dices",
        properties: {
            route: {
                type: Object
            },
            page: {
                type: String
            },
            tail: {
                type: String
            },
            sheetList: {
                type: Object
            },
            baseSheet: {
                type: Object
            },
            creatingSheet: {
                type: Object
            }
        },
        ready: function(e){
            console.log("Dungeons 'n Dices Loaded");
        },
        attached: function(e){
            console.log("Route to Sheet List");
            if(!this.route.path || this.route.path == '/sheetDetail'){
                this.set('route.path', '/home');
            }
        },
        sideNavRouteWillChange: function(e){
            console.log('SideNav: Route Will Chage');
            document.querySelector("paper-drawer-panel").closeDrawer()
        },
        initializeDefaultSheetList: function(e) {
            this.sheetList = {
                list: []
            };
        },
        initializeDefaultBaseSheet: function(e){
            this.baseSheet = {
                name: "",
                job: "",
                race: "",
                level: "1",
                system: "",
                statusList: [
                    {
                        name: "Str/Dex/Int/...",
                        value: 0,
                        baseValue: 0,
                        levelModifier: 0,
                        persistBonus: 0,
                        volatileBonus: 0
                    }
                ],
                // { *name: "vit", value: SUM, *baseValue: 10, *levelModifier: 0, persistBonus: 0, volatileBonus: 0 }, ...
                resourcesList: [
                    {
                        name: "HP/MP/...",
                        value: 0,
                        baseValue: 0,
                        statusBase:  "None",
                        statusBaseModifier: 1,
                        levelModifier: 0.5,
                        persistBonus: 0,
                        volatileBonus: 0
                    }
                ],
                // { *name: "hp", value: SUM, *baseValue: 10, *statusBase: Vit, *statusBaseModifier: 1, *levelModifier: 0, persistBonus: 0, volatileBonus: 0 }, ...
                defensesList: [
                    {
                        name: "Armor/Magic Resistence/...",
                        value: 0,
                        baseValue: 10,
                        statusBase: "None",
                        statusBaseModifier: 1,
                        levelModifier: 0.5,
                        persistBonus: 0,
                        volatileBonus: 0
                    }
                ],
                // { *name: "armor", value: SUM, *baseValue: 10, *statusBase: Vit, *statusBaseModifier: 1, *levelModifier: 0, persistBonus: 0, volatileBonus: 0 }, ...
                attacksList: [],
                // { *name: "attackName", AttackValue: SUM, DamageValue: SUM, *baseAttack: 10, *attackStatusBase: Vit, *attackStatusBaseModifier: 1, *attackLevelModifier: 0, attackpersistBonus: 0, attackVolatileBonus: 0, *baseDamage: 10, *damageStatusBase: Vit, *damageStatusBaseModifier: 1, *damageLevelModifier: 0, damagepersistBonus: 0, damageVolatileBonus: 0 }, ...
                skillsList: [
                    {
                        name: "Diplomacy/Heal...",
                        value: 0,
                        baseValue: 10,
                        statusBase: "None",
                        statusBaseModifier: 1,
                        levelModifier: 0.5,
                        persistBonus: 0,
                        volatileBonus: 0
                    }
                ],
                // { *name: "skillName", value: SUM, *baseValue: 10, *statusBase: Vit, *statusBaseModifier: 1, *levelModifier: 0, persistBonus: 0, volatileBonus: 0 }, ...
                equipments: {
                    head: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    chest: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    legs: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    feet: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    hands: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    cloak: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    waist: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    wrist: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                    trinkets: {},
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }, ...
                    weapon: {},
                    // *equipmentName: { *type: 1, *attack: 10, *damage: 10, effect1: { *value: 10, *affect: Armor }, ... }
                    shield: {}
                    // *equipmentName: { effect1: { *value: 10, *affect: Armor }, ... }
                },
                persistBonusList: [],
                // { name: "bonusName", *value: 10, *affect: Vit }, ...  Kind of: Equipment Bonus
                volatileBonusList: []
                // { *name: "bonusName", *value: 10, *affect: Vit }, ...  Kind of: Potion Bonus
            }
        },
        initializeDefaultCreatingSheet: function(e){
            if((typeof this.creatingSheet == 'undefined' || this.creatingSheet == null)  && this.baseSheet != null){
                //this.creatingSheet = Object.create(this.baseSheet);
                this.creatingSheet = Object.assign({}, this.baseSheet);
                console.log('Creating Sheet Assigned as Base Sheet');
            }
        }
    });
</script>
